<html>
  <head>

    <title>
      The C Programming Language Exercise 1-23
    </title>

  <BODY    text="#000000"
        bgcolor="#DDDDDD"
           link="#800000"
          alink="#008000"
          vlink="#000080">


<center>
<h2>
  &quot;The C Programming Language&quot;, 2nd edition, Kernighan and Ritchie
</h2>
<h3>
  Answer to Exercise 1-23, page 34
</h3>
<h4>
  Solutions by
<p> <a href=mailto:rick@ricken.demon.co.uk>  Rick Dearman </a> </p>
<p> <a href=mailto:pfaffben@msu.edu>  Ben Pfaff </a> (two solutions) </p>
<p> <a href=mailto:lpitcher@yesic.com>  Lew Pitcher </a> </p>
<p> <a href=mailto:gkp1@flash.net>  Gregory Pietsch </a> </p>
<p> <a href=mailto:torek@elf.bsdi.com>  Chris Torek </a> </p>
<p> <a href=mailto:cmears@bigpond.com>  Chris Mears </a> </p>
<br>
  Critique by
<p> <a href=mailto:ralither@bellsouth.net>  Rick Litherland </a> </p>
  (see end of page)
</h4>
</center>
<br>
<br>
<i>
Write a program to remove all comments from a C program. Don't forget
to handle quoted strings and character constants properly. C comments do not nest.
</i>
<br>
<br>
<br>
This was the first exercise to be posted as a fun &quot;competition&quot; on comp.lang.c,
on 1 June 2000. As a result, there was a small flurry of submissions. Not all
of them are completely working solutions. See the very end of this page for a
test program which breaks most of them. :-)
<br>
<br>
<br>
<h5>
Category 0 Solutions
</h5>
<br>
From Rick Dearman
<br>
<br>
Now handles &quot;/* comment in string */&quot; correctly, but does not remove the
comment from

<code>
<pre>
  <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#008080">/* comment inside return statement */</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
</pre>
</code>

<br>
<br>
<code>
<pre>
<FONT COLOR="#008080">/******************************************************
&quot;Write a program to remove all comments from a C program. 
Don't forget to handle quoted strings and character 
constants properly. C comments do not nest.&quot;

Author: Rick Dearman (rick@ricken.demon.co.uk) 
******************************************************/</FONT>

<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>

<FONT COLOR="#0000FF"><B>#define MAXLINE 1000 /* max input line size */</B></FONT>
<B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">MAXLINE</FONT><FONT COLOR="#000080">];</FONT> <FONT COLOR="#008080">/*current input line*/</FONT>

<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">getline</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">);</FONT>  <FONT COLOR="#008080">/* taken from the KnR book. */</FONT>


<B><FONT COLOR="#000080">int</FONT></B>
<FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">()</FONT>
<FONT COLOR="#000080">{</FONT>
  <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">in_comment</FONT><FONT COLOR="#000080">,</FONT><FONT COLOR="#008000">len</FONT><FONT COLOR="#000080">;</FONT>
  <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">in_quote</FONT><FONT COLOR="#000080">;</FONT>
  <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">;</FONT>
  
  <FONT COLOR="#008000">in_comment</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">in_quote</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">t</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
  <B><FONT COLOR="#000080">while</FONT></B> <FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">len</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">getline</FONT><FONT COLOR="#000080">())</FONT> <FONT COLOR="#000080">&gt;</FONT> <FONT COLOR="#000000"><B>0</B></FONT> <FONT COLOR="#000080">)</FONT>
    <FONT COLOR="#000080">{</FONT>
      <FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
      <B><FONT COLOR="#000080">while</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">t</FONT> <FONT COLOR="#000080">&lt;</FONT> <FONT COLOR="#008000">len</FONT><FONT COLOR="#000080">)</FONT>
        <FONT COLOR="#000080">{</FONT>
	  <B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT> <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'&quot;'</B></FONT><FONT COLOR="#000080">)</FONT>
		<FONT COLOR="#008000">in_quote</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;</FONT>

	  <B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT> <FONT COLOR="#000080">!</FONT> <FONT COLOR="#008000">in_quote</FONT> <FONT COLOR="#000080">)</FONT>
	  <FONT COLOR="#000080">{</FONT>
          	<B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT> <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
            	<FONT COLOR="#000080">{</FONT>
              		<FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>2</B></FONT><FONT COLOR="#000080">;</FONT>
              		<FONT COLOR="#008000">in_comment</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;</FONT>
            	<FONT COLOR="#000080">}</FONT>
          	<B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT> <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT>
            	<FONT COLOR="#000080">{</FONT>
              		<FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>2</B></FONT><FONT COLOR="#000080">;</FONT>
              		<FONT COLOR="#008000">in_comment</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
            	<FONT COLOR="#000080">}</FONT>
          	<B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">in_comment</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">)</FONT>
           	 <FONT COLOR="#000080">{</FONT>
              		<FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">++;</FONT>
            	<FONT COLOR="#000080">}</FONT>
          	<B><FONT COLOR="#000080">else</FONT></B>
            	<FONT COLOR="#000080">{</FONT>
              		<FONT COLOR="#008000">printf</FONT> <FONT COLOR="#000080">(</FONT><FONT COLOR="#000000">&quot;%c&quot;</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">]);</FONT>
              		<FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">++;</FONT>
            	<FONT COLOR="#000080">}</FONT>
	  <FONT COLOR="#000080">}</FONT> 
	  <B><FONT COLOR="#000080">else</FONT></B>
	  <FONT COLOR="#000080">{</FONT>
              <FONT COLOR="#008000">printf</FONT> <FONT COLOR="#000080">(</FONT><FONT COLOR="#000000">&quot;%c&quot;</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">]);</FONT>
              <FONT COLOR="#008000">t</FONT><FONT COLOR="#000080">++;</FONT>
	  <FONT COLOR="#000080">}</FONT>
        <FONT COLOR="#000080">}</FONT>
    <FONT COLOR="#000080">}</FONT>
  <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>


<FONT COLOR="#008080">/* getline: specialized version */</FONT>
<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">getline</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
  <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">;</FONT>
  <B><FONT COLOR="#000080">extern</FONT></B> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[];</FONT>
  
  <B><FONT COLOR="#000080">for</FONT></B> <FONT COLOR="#000080">(</FONT> <FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">&lt;</FONT><FONT COLOR="#008000">MAXLINE</FONT><FONT COLOR="#000080">-</FONT><FONT COLOR="#000000"><B>1</B></FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#000080">(</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">getchar</FONT><FONT COLOR="#000080">())</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">;</FONT> <FONT COLOR="#000080">++</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">)</FONT>
    <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>
  <B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">)</FONT> 
    <FONT COLOR="#000080">{</FONT>
      <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>
      <FONT COLOR="#000080">++</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">;</FONT>
    <FONT COLOR="#000080">}</FONT>
  <FONT COLOR="#008000">line</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'\0'</B></FONT><FONT COLOR="#000080">;</FONT>
  <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">;</FONT>

<FONT COLOR="#000080">}</FONT>

</pre>
</code>

<br>
<br>
<br>
From Ben Pfaff
<br>
<br>
This version is a bugfix for the code var/'\2'
<br>
<br>
<code>
<pre>
<FONT COLOR="#008080">/* K&amp;R2 1-23: Write a program to remove all comments from a C program.
   Don't forget to handle quoted strings and character constants
   properly.  C comments do not nest.

   This solution does not deal with other special cases, such as
   trigraphs, line continuation with \, or &lt;&gt; quoting on #include,
   since these aren't mentioned up 'til then in K&amp;R2.  Perhaps this is
   cheating.

   Note that this program contains both comments and quoted strings of
   text that looks like comments, so running it on itself is a
   reasonable test.  It also contains examples of a comment that ends
   in a star and a comment preceded by a slash.  Note that the latter
   will break C99 compilers and C89 compilers with // comment
   extensions.

   Interface: The C source file is read from stdin and the
   comment-less output is written to stdout. **/</FONT>

<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>

<B><FONT COLOR="#000080">int</FONT></B>
<FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
<FONT COLOR="#0000FF"><B>#define PROGRAM 0</B></FONT>
<FONT COLOR="#0000FF"><B>#define SLASH 1</B></FONT>
<FONT COLOR="#0000FF"><B>#define COMMENT 2</B></FONT>
<FONT COLOR="#0000FF"><B>#define STAR 3</B></FONT>
<FONT COLOR="#0000FF"><B>#define QUOTE 4</B></FONT>
<FONT COLOR="#0000FF"><B>#define LITERAL 5</B></FONT>

    <FONT COLOR="#008080">/* State machine's current state, one of the above values. */</FONT>
    <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">;</FONT>

    <FONT COLOR="#008080">/* If state == QUOTE, then ' or &quot;.  Otherwise, undefined. */</FONT>
    <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">quote</FONT><FONT COLOR="#000080">;</FONT>

    <FONT COLOR="#008080">/* Input character. */</FONT>
    <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>

    <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
    <B><FONT COLOR="#000080">while</FONT></B> <FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">getchar</FONT><FONT COLOR="#000080">())</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
        <FONT COLOR="#008080">/* The following cases are in guesstimated order from most common
           to least common. */</FONT>
        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">PROGRAM</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                <FONT COLOR="#008080">/* Program text following a slash. */</FONT>
                <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
                    <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
                <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
                    <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">);</FONT>
                    <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
                <FONT COLOR="#000080">}</FONT>
            <FONT COLOR="#000080">}</FONT>

            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                <FONT COLOR="#008080">/* Program text. */</FONT>
                <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\''</B></FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'&quot;'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                    <FONT COLOR="#008000">quote</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>
                    <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">;</FONT>
                    <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
                <FONT COLOR="#000080">}</FONT>
                <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000">&quot;/*&quot;</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">])</FONT>
                    <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">;</FONT>
                <B><FONT COLOR="#000080">else</FONT></B>
                    <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#000080">}</FONT>
        <FONT COLOR="#000080">}</FONT>
        <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
            <FONT COLOR="#008080">/* Comment. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000">&quot;/*&quot;</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">])</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">STAR</FONT><FONT COLOR="#000080">;</FONT>
        <FONT COLOR="#000080">}</FONT>
        <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
            <FONT COLOR="#008080">/* Within quoted string or character constant. */</FONT>
            <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">LITERAL</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">quote</FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
        <FONT COLOR="#000080">}</FONT>
        <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
        <FONT COLOR="#000080">}</FONT>
        <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">STAR</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
            <FONT COLOR="#008080">/* Comment following a star. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
        <FONT COLOR="#000080">}</FONT>
        <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#008080">/* state == LITERAL */</FONT> <FONT COLOR="#000080">{</FONT>
            <FONT COLOR="#008080">/* Within quoted string or character constant, following \. */</FONT>
            <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">;</FONT>
        <FONT COLOR="#000080">}</FONT>
    <FONT COLOR="#000080">}</FONT>

    <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">)</FONT>
        <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT> <FONT COLOR="#008080">//**/</FONT>
                <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">);</FONT>

    <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>

<FONT COLOR="#008080">/* 
   Local variables:
   compile-command: &quot;checkergcc -W -Wall -ansi -pedantic knr123-0.c -o knr123-0&quot;
   End: 
*/</FONT>



</pre>
</code>

<br>
<br>
<br>
From Lew Pitcher
<br>
<br>
<code>
<pre>
<FONT COLOR="#008080">/* Lew Pitcher &lt;lpitcher@yesic.com&gt; */</FONT>

<FONT COLOR="#008080">/*/</FONT>
<FONT COLOR="#000080">**</FONT> <FONT COLOR="#008000">derem</FONT> <FONT COLOR="#000080">-</FONT> <FONT COLOR="#008000">remove</FONT> <FONT COLOR="#008000">C</FONT> <FONT COLOR="#008000">comments</FONT>
<FONT COLOR="#000080">**</FONT>
<FONT COLOR="#000080">**</FONT> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">attempt</FONT> <FONT COLOR="#008000">to</FONT> <FONT COLOR="#008000">solve</FONT> <FONT COLOR="#008000">K</FONT><FONT COLOR="#000080">&amp;</FONT><FONT COLOR="#008000">R</FONT> <FONT COLOR="#008000">Exercise</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">-</FONT><FONT COLOR="#000000"><B>22</B></FONT><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">**</FONT>
<FONT COLOR="#000080">**</FONT> <FONT COLOR="#008000">As</FONT> <FONT COLOR="#008000">I</FONT> <FONT COLOR="#008000">only</FONT> <FONT COLOR="#008000">have</FONT> <FONT COLOR="#008000">v1</FONT> <FONT COLOR="#008000">copy</FONT> <FONT COLOR="#008000">of</FONT> <FONT COLOR="#008000">K</FONT><FONT COLOR="#000080">&amp;</FONT><FONT COLOR="#008000">R</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">I</FONT> <FONT COLOR="#008000">cannot</FONT>
<FONT COLOR="#000080">**</FONT> <FONT COLOR="#008000">be</FONT> <FONT COLOR="#008000">sure</FONT> <FONT COLOR="#008000">what</FONT> <FONT COLOR="#008000">is</FONT> <FONT COLOR="#008000">covered</FONT> <FONT COLOR="#008000">in</FONT> <FONT COLOR="#008000">K</FONT><FONT COLOR="#000080">&amp;</FONT><FONT COLOR="#008000">R</FONT> <FONT COLOR="#008000">ANSI</FONT> <FONT COLOR="#008000">chapter</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">.</FONT>
<FONT COLOR="#000080">**</FONT> <FONT COLOR="#008000">So</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">I</FONT> <FONT COLOR="#008000">restrict</FONT> <FONT COLOR="#008000">myself</FONT> <FONT COLOR="#008000">to</FONT> <FONT COLOR="#008000">the</FONT> <FONT COLOR="#008000">components</FONT> <FONT COLOR="#008000">covered</FONT>
<FONT COLOR="#000080">**</FONT> <FONT COLOR="#008000">in</FONT> <FONT COLOR="#008000">K</FONT><FONT COLOR="#000080">&amp;</FONT><FONT COLOR="#008000">R</FONT> <FONT COLOR="#008000">v1</FONT> <FONT COLOR="#008000">chapter</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">but</FONT> <FONT COLOR="#008000">modified</FONT> <B><FONT COLOR="#000080">for</FONT></B> <FONT COLOR="#008000">requisite</FONT> <FONT COLOR="#008000">ANSI</FONT>
<FONT COLOR="#000080">**</FONT> <FONT COLOR="#008000">features</FONT> <FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">()</FONT> <FONT COLOR="#008000">and</FONT> <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#008000">value</FONT><FONT COLOR="#000080">).</FONT>
<FONT COLOR="#000080">**</FONT>
<FONT COLOR="#000080">**</FONT> <FONT COLOR="#008000">Components</FONT> <FONT COLOR="#008000">covered</FONT> <FONT COLOR="#008000">in</FONT> <FONT COLOR="#008000">v1</FONT> <FONT COLOR="#008000">K</FONT><FONT COLOR="#000080">&amp;</FONT><FONT COLOR="#008000">R</FONT> <FONT COLOR="#008000">chapter</FONT> <FONT COLOR="#000000"><B>1</B></FONT> <FONT COLOR="#008000">include</FONT><FONT COLOR="#000080">:</FONT>
<FONT COLOR="#000080">**</FONT>  <B><FONT COLOR="#000080">while</FONT></B> <FONT COLOR="#000080">(),</FONT> <B><FONT COLOR="#000080">for</FONT></B> <FONT COLOR="#000080">(),</FONT> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">()</FONT> <B><FONT COLOR="#000080">else</FONT></B>
<FONT COLOR="#000080">**</FONT>  <FONT COLOR="#008000">getchar</FONT><FONT COLOR="#000080">(),</FONT> <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(),</FONT> <FONT COLOR="#008000">EOF</FONT>
<FONT COLOR="#000080">**</FONT>  <FONT COLOR="#008000">character</FONT> <FONT COLOR="#008000">constants</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">character</FONT> <FONT COLOR="#008000">escapes</FONT>
<FONT COLOR="#000080">**</FONT>  <FONT COLOR="#008000">strings</FONT>
<FONT COLOR="#000080">**</FONT>  <FONT COLOR="#008000">array</FONT> <FONT COLOR="#008000">subscripting</FONT>
<FONT COLOR="#000080">**</FONT>
<FONT COLOR="#000080">**</FONT> <FONT COLOR="#008000">Not</FONT> <FONT COLOR="#008000">directly</FONT> <FONT COLOR="#008000">covered</FONT> <FONT COLOR="#008000">are</FONT>
<FONT COLOR="#000080">**</FONT>  <FONT COLOR="#008000">string</FONT> <FONT COLOR="#008000">subscripting</FONT> <FONT COLOR="#000080">(</FONT> <FONT COLOR="#000000">&quot;/*&quot;</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">**</FONT>  <FONT COLOR="#008000">initializers</FONT> <FONT COLOR="#000080">(</FONT> <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT> <FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">**/</FONT>

<FONT COLOR="#008080">/*/</FONT><FONT COLOR="#000080">*/</FONT>

<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>

<FONT COLOR="#0000FF"><B>#define	PROGRAM		0</B></FONT>
<FONT COLOR="#0000FF"><B>#define	BEGIN_COMMENT	1</B></FONT>
<FONT COLOR="#0000FF"><B>#define	COMMENT		2</B></FONT>
<FONT COLOR="#0000FF"><B>#define	END_COMMENT	3</B></FONT>
<FONT COLOR="#0000FF"><B>#define	QUOTE		4</B></FONT>

<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
	<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">this_char</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">quote_char</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">;</FONT>

	<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>

	<B><FONT COLOR="#000080">while</FONT></B> <FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">getchar</FONT><FONT COLOR="#000080">())</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT>
	<FONT COLOR="#000080">{</FONT>
		<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">)</FONT>
		<FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">BEGIN_COMMENT</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'&quot;'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\''</B></FONT><FONT COLOR="#000080">))</FONT>
			<FONT COLOR="#000080">{</FONT>
				<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">;</FONT>
				<FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">quote_char</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">this_char</FONT><FONT COLOR="#000080">);</FONT>
			<FONT COLOR="#000080">}</FONT>
			<B><FONT COLOR="#000080">else</FONT></B>	<FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT><FONT COLOR="#000080">);</FONT>
		<FONT COLOR="#000080">}</FONT>
		<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">BEGIN_COMMENT</FONT><FONT COLOR="#000080">)</FONT>
		<FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">else</FONT></B>
			<FONT COLOR="#000080">{</FONT>
				<FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">);</FONT> <FONT COLOR="#008080">/* for the '/' of the comment */</FONT>
				<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#000080">{</FONT>
					<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
					<FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT><FONT COLOR="#000080">);</FONT>
				<FONT COLOR="#000080">}</FONT>
				<B><FONT COLOR="#000080">else</FONT></B>	<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>	<FONT COLOR="#008080">/* stuttered */</FONT>
			<FONT COLOR="#000080">}</FONT>
		<FONT COLOR="#000080">}</FONT>
		<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">)</FONT>
		<FONT COLOR="#000080">{</FONT>
			<FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT><FONT COLOR="#000080">);</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">getchar</FONT><FONT COLOR="#000080">());</FONT>	<FONT COLOR="#008080">/* escaped character */</FONT>
			<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">quote_char</FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
		<FONT COLOR="#000080">}</FONT>
		<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">)</FONT>
		<FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">END_COMMENT</FONT><FONT COLOR="#000080">;</FONT>
		<FONT COLOR="#000080">}</FONT>
		<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">END_COMMENT</FONT><FONT COLOR="#000080">)</FONT>
		<FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">this_char</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>	<FONT COLOR="#008080">/* stuttered */</FONT>
				<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
		<FONT COLOR="#000080">}</FONT>
	<FONT COLOR="#000080">}</FONT>

	<B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>

</pre>
</code>

<br>
<br>
<br>
From Gregory Pietsch
<br>
<br>
<code>
<pre>
<FONT COLOR="#008080">/* Gregory Pietsch &lt;gkp1@flash.net&gt; */</FONT>

<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>

<B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[]</FONT> <FONT COLOR="#000080">=</FONT>
<FONT COLOR="#000000">&quot;0/!10\&quot;040\'050.001/011*!21\&quot;/41\'/51./02*!32.!23/ &quot;</FONT>
<FONT COLOR="#000000">&quot;03*!33.!24\&quot;004\\064.045\'005\\075.056.047.05&quot;</FONT><FONT COLOR="#000080">;</FONT>

<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(){</FONT><B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">,</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">,</FONT><FONT COLOR="#008000">d</FONT><FONT COLOR="#000080">;</FONT><B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">s</FONT><FONT COLOR="#000080">,</FONT><FONT COLOR="#008000">n</FONT><FONT COLOR="#000080">;</FONT><FONT COLOR="#008000">s</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>'0'</B></FONT><FONT COLOR="#000080">;</FONT><B><FONT COLOR="#000080">while</FONT></B><FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">getchar</FONT><FONT COLOR="#000080">())</FONT>
<FONT COLOR="#000080">!=</FONT><FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">){</FONT><FONT COLOR="#008000">d</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT><B><FONT COLOR="#000080">for</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">]!=</FONT><FONT COLOR="#000000"><B>'\0'</B></FONT><FONT COLOR="#000080">&amp;&amp;</FONT><FONT COLOR="#008000">d</FONT><FONT COLOR="#000080">==</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>4</B></FONT><FONT COLOR="#000080">){</FONT><B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#008000">s</FONT><FONT COLOR="#000080">&amp;&amp;</FONT>
<FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">||</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#000000"><B>'.'</B></FONT><FONT COLOR="#000080">)){</FONT><B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>2</B></FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#000000"><B>'0'</B></FONT><FONT COLOR="#000080">)</FONT><FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT><B><FONT COLOR="#000080">else</FONT></B>
<B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>2</B></FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">){</FONT><FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">);</FONT><FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);}</FONT><B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>2</B></FONT><FONT COLOR="#000080">]</FONT>
<FONT COLOR="#000080">==</FONT><FONT COLOR="#000000"><B>' '</B></FONT><FONT COLOR="#000080">)</FONT><FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>' '</B></FONT><FONT COLOR="#000080">);</FONT><FONT COLOR="#008000">n</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>3</B></FONT><FONT COLOR="#000080">];</FONT><FONT COLOR="#008000">d</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;}}</FONT><FONT COLOR="#008000">s</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">n</FONT><FONT COLOR="#000080">;}</FONT><B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;}</FONT>

</pre>
</code>

<br>
<br>
<br>
<br>
<h5>
Category 1 Solutions
</h5>
<br>
From Ben Pfaff (again)
<br>
<br>
This version has the var/'\2' bug fix.
<br>
<br>
<code>
<pre>
<FONT COLOR="#008080">/* K&amp;R2 1-23: Write a program to remove all comments from a C program.
   Don't forget to handle quoted strings and character constants
   properly.  C comments do not nest.

   This solution does not deal with other special cases, such as
   trigraphs, line continuation with \, or &lt;&gt; quoting on #include,
   since these aren't mentioned up 'til then in K&amp;R2.  Perhaps this is
   cheating.

   Note that this program contains both comments and quoted strings of
   text that looks like comments, so running it on itself is a
   reasonable test.  It also contains examples of a comment that ends
   in a star and a comment preceded by a slash.  Note that the latter
   will break C99 compilers and C89 compilers with // comment
   extensions.

   Interface: The C source file is read from stdin and the
   comment-less output is written to stdout. **/</FONT>

<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>

<B><FONT COLOR="#000080">int</FONT></B>
<FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
    <FONT COLOR="#008080">/* State machine's current state. */</FONT>
    <B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#000080">{</FONT>
        <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">STAR</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">LITERAL</FONT>
    <FONT COLOR="#000080">}</FONT> <FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">;</FONT>

    <FONT COLOR="#008080">/* If state == QUOTE, then ' or &quot;.  Otherwise, undefined. */</FONT>
    <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">quote</FONT><FONT COLOR="#000080">;</FONT>

    <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
    <B><FONT COLOR="#000080">for</FONT></B> <FONT COLOR="#000080">(;;)</FONT> <FONT COLOR="#000080">{</FONT>
        <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">getchar</FONT><FONT COLOR="#000080">();</FONT>
        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT> <FONT COLOR="#008080">//**/</FONT>
                        <FONT COLOR="#000000"><B>1</B></FONT> <FONT COLOR="#000080">/</FONT> <FONT COLOR="#000000"><B>1</B></FONT> <FONT COLOR="#000080">/</FONT><FONT COLOR="#000000"><B>'\1'</B></FONT><FONT COLOR="#000080">);</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
        <FONT COLOR="#000080">}</FONT>

        <B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Program text following a slash. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000">&quot;/*&quot;</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">])</FONT> <FONT COLOR="#000080">{</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
                <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
            <FONT COLOR="#000080">}</FONT>
            <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
            <FONT COLOR="#008080">/* Fall through. */</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Program text. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\''</B></FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'&quot;'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                <FONT COLOR="#008000">quote</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">;</FONT>
                <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#000080">}</FONT>
            <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000">&quot;/*&quot;</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">])</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">else</FONT></B>
                <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Comment. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">STAR</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">STAR</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Comment following a star. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
                <FONT COLOR="#008000">putchar</FONT> <FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>' '</B></FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#000080">}</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Within quoted string or character constant. */</FONT>
            <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">LITERAL</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">quote</FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">LITERAL</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Within quoted string or character constant, following \. */</FONT>
            <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008000">abort</FONT><FONT COLOR="#000080">();</FONT>
        <FONT COLOR="#000080">}</FONT>
    <FONT COLOR="#000080">}</FONT>

    <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>

<FONT COLOR="#008080">/* 
   Local variables:
   compile-command: &quot;checkergcc -W -Wall -ansi -pedantic knr123.c -o knr123&quot;
   End: 
*/</FONT>


</pre>
</code>

<br>
<br>
<br>
From Chris Torek
<br>
<br>
<code>
<pre>
<FONT COLOR="#008080">/* torek@elf.bsdi.com (Chris Torek) */</FONT>

<FONT COLOR="#008080">/*
&quot;Write a program to remove all comments from a C program. Don't forget
to handle quoted strings and character constants properly. C comments do
not nest.&quot;

Well, what the heck.  I mailed this a day or two ago, but here is
the posted version.  I modified the problem a bit: it removes
comments from full ANSI C89 or C99 programs, handling trigraphs
and \-newline sequences.  It attempts to preserve any trigraphs in
the output, even while examining them in the &quot;C code&quot; as their
translated characters.  (I am not sure why I bothered doing all of
them, when only ??/ matters here.)  It keeps output line numbers in
sync with input line numbers, so that if the output is compiled,
any error messages will refer back to the proper input source line.

Lightly tested.
*/</FONT>

<FONT COLOR="#0000FF"><B>#include &lt;assert.h&gt;</B></FONT>
<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>
<FONT COLOR="#0000FF"><B>#include &lt;stdlib.h&gt;</B></FONT>
<FONT COLOR="#0000FF"><B>#include &lt;string.h&gt;</B></FONT>

<FONT COLOR="#008080">/*
 * This flag controls whether we do trigraph processing.
 */</FONT>
<B><FONT COLOR="#000080">int</FONT></B>	<FONT COLOR="#008000">trigraphs</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;</FONT>

<FONT COLOR="#008080">/*
 * This flag controls whether a comment becomes &quot;whitespace&quot; (ANSI C)
 * or &quot;nothing at all&quot; (some pre-ANSI K&amp;R C compilers).
 */</FONT>
<B><FONT COLOR="#000080">int</FONT></B>	<FONT COLOR="#008000">whitespace</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;</FONT>

<FONT COLOR="#008080">/*
 * This flag controls whether we do C89 or C99.  (C99 also handles C++.)
 */</FONT>
<B><FONT COLOR="#000080">int</FONT></B>	<FONT COLOR="#008000">c99</FONT><FONT COLOR="#000080">;</FONT>

<FONT COLOR="#008080">/*
 * These are global so that options() can get at them, and for later
 * error messages if needed.
 */</FONT>
<B><FONT COLOR="#000080">const</FONT></B> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">inname</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">outname</FONT><FONT COLOR="#000080">;</FONT>

<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">options</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">const</FONT></B> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">*,</FONT> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">**);</FONT>
<B><FONT COLOR="#000080">void</FONT></B> <FONT COLOR="#008000">usage</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">);</FONT>

<B><FONT COLOR="#000080">void</FONT></B>	<FONT COLOR="#008000">process</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">FILE</FONT> <FONT COLOR="#000080">*,</FONT> <FONT COLOR="#008000">FILE</FONT> <FONT COLOR="#000080">*);</FONT>

<FONT COLOR="#0000FF"><B>#ifdef __GNUC__</B></FONT>
<B><FONT COLOR="#000080">void</FONT></B>	<FONT COLOR="#008000">panic</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">const</FONT></B> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">*)</FONT> <FONT COLOR="#008000">__attribute__</FONT><FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">noreturn</FONT><FONT COLOR="#000080">));</FONT>
<FONT COLOR="#0000FF"><B>#else</B></FONT>
<B><FONT COLOR="#000080">void</FONT></B>	<FONT COLOR="#008000">panic</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">const</FONT></B> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">*);</FONT>
<FONT COLOR="#0000FF"><B>#endif</B></FONT>

<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">argc</FONT><FONT COLOR="#000080">,</FONT> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">**</FONT><FONT COLOR="#008000">argv</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
	<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#008000">FILE</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">out</FONT><FONT COLOR="#000080">;</FONT>

	<B><FONT COLOR="#000080">for</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">i</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;</FONT> <FONT COLOR="#008000">i</FONT> <FONT COLOR="#000080">&lt;</FONT> <FONT COLOR="#008000">argc</FONT><FONT COLOR="#000080">;</FONT> <FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">++)</FONT> <FONT COLOR="#000080">{</FONT>
		<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">argv</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">][</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'-'</B></FONT><FONT COLOR="#000080">)</FONT>
			<FONT COLOR="#008000">i</FONT> <FONT COLOR="#000080">+=</FONT> <FONT COLOR="#008000">options</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">argv</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">+</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">argv</FONT> <FONT COLOR="#000080">+</FONT> <FONT COLOR="#008000">i</FONT> <FONT COLOR="#000080">+</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">);</FONT>
		<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">inname</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">NULL</FONT><FONT COLOR="#000080">)</FONT>
			<FONT COLOR="#008000">inname</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">argv</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">];</FONT>
		<B><FONT COLOR="#000080">else</FONT></B>
			<FONT COLOR="#008000">usage</FONT><FONT COLOR="#000080">();</FONT>
	<FONT COLOR="#000080">}</FONT>
	<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">inname</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">NULL</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
		<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">in</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">fopen</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">inname</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;r&quot;</FONT><FONT COLOR="#000080">))</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">NULL</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<FONT COLOR="#008000">fprintf</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">stderr</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;cannot open %s for reading\n&quot;</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">inname</FONT><FONT COLOR="#000080">);</FONT>
			<FONT COLOR="#008000">exit</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">EXIT_FAILURE</FONT><FONT COLOR="#000080">);</FONT>
		<FONT COLOR="#000080">}</FONT>
	<FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
		<FONT COLOR="#008000">inname</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000">&quot;stdin&quot;</FONT><FONT COLOR="#000080">;</FONT>
		<FONT COLOR="#008000">in</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">stdin</FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#000080">}</FONT>
	<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">outname</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">NULL</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
		<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">out</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">fopen</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">outname</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;w&quot;</FONT><FONT COLOR="#000080">))</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">NULL</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<FONT COLOR="#008000">fprintf</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">stderr</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;cannot open %s for writing\n&quot;</FONT><FONT COLOR="#000080">,</FONT>
			    <FONT COLOR="#008000">outname</FONT><FONT COLOR="#000080">);</FONT>
			<FONT COLOR="#008000">exit</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">EXIT_FAILURE</FONT><FONT COLOR="#000080">);</FONT>
		<FONT COLOR="#000080">}</FONT>
	<FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
		<FONT COLOR="#008000">outname</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000">&quot;stdout&quot;</FONT><FONT COLOR="#000080">;</FONT>
		<FONT COLOR="#008000">out</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">stdout</FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#000080">}</FONT>
	<FONT COLOR="#008000">process</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">out</FONT><FONT COLOR="#000080">);</FONT>
	<FONT COLOR="#008000">fclose</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">);</FONT>
	<FONT COLOR="#008000">fclose</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">out</FONT><FONT COLOR="#000080">);</FONT>
	<FONT COLOR="#008000">exit</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">EXIT_SUCCESS</FONT><FONT COLOR="#000080">);</FONT>
<FONT COLOR="#000080">}</FONT>

<FONT COLOR="#008080">/*
 * This scans for -o type options.  Options that have an argument
 * can either take it immediately or as a subsequent argument (e.g.,
 * -ofoo means the same thing as -o foo).  We return 0 for &quot;handled
 * them normally&quot;, 1 for &quot;handled them normally but needed more
 * arguments&quot;.
 *
 * Currently this function is more powerful than really needed, but
 * if we ever decide to have more arguments...
 */</FONT>
<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">options</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">const</FONT></B> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">afterdash</FONT><FONT COLOR="#000080">,</FONT> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">**</FONT><FONT COLOR="#008000">moreargs</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
	<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">nmore</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>

	<B><FONT COLOR="#000080">while</FONT></B> <FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">afterdash</FONT><FONT COLOR="#000080">++)</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'\0'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
		<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'o'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(*</FONT><FONT COLOR="#008000">afterdash</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
				<FONT COLOR="#008000">outname</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">afterdash</FONT><FONT COLOR="#000080">;</FONT>
				<FONT COLOR="#008000">afterdash</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000">&quot;&quot;</FONT><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">moreargs</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">nmore</FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">NULL</FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">outname</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">moreargs</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">nmore</FONT><FONT COLOR="#000080">++];</FONT>
			<B><FONT COLOR="#000080">else</FONT></B>
				<FONT COLOR="#008000">usage</FONT><FONT COLOR="#000080">();</FONT>
		<FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'t'</B></FONT><FONT COLOR="#000080">)</FONT>
			<FONT COLOR="#008000">trigraphs</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
		<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'w'</B></FONT><FONT COLOR="#000080">)</FONT>
			<FONT COLOR="#008000">whitespace</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
		<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'9'</B></FONT><FONT COLOR="#000080">)</FONT>
			<FONT COLOR="#008000">c99</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;</FONT>
		<B><FONT COLOR="#000080">else</FONT></B>
			<FONT COLOR="#008000">usage</FONT><FONT COLOR="#000080">();</FONT>
	<FONT COLOR="#000080">}</FONT>
	<B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#008000">nmore</FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>

<B><FONT COLOR="#000080">void</FONT></B> <FONT COLOR="#008000">usage</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
	<FONT COLOR="#008000">fprintf</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">stderr</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;usage: uncomment [-9tw] [-o outfile] [infile]\n&quot;</FONT><FONT COLOR="#000080">);</FONT>
	<FONT COLOR="#008000">exit</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">EXIT_FAILURE</FONT><FONT COLOR="#000080">);</FONT>	<FONT COLOR="#008080">/* ??? */</FONT>
<FONT COLOR="#000080">}</FONT>

<FONT COLOR="#008080">/*
 * States, level 0:
 *	normal
 *	trigraph processing: Q1 Q2 (for ??x)
 *
 * States, level 1:
 *	backslash-newline processing: BACK (seen \, may consume NL)
 *
 * States, level 2:
 *	normal
 *	character constant: CC (seen '), CCBACK (seen \ inside CC)
 *	string constant: SC, SCBACK
 *	comment: SLASH, COMM, COMMSTAR (for /, in-comment, &amp; seen-star)
 *	C99: SLASHSLASH
 */</FONT>

<B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">l0state</FONT> <FONT COLOR="#000080">{</FONT>
	<FONT COLOR="#008000">L0_NORMAL</FONT><FONT COLOR="#000080">,</FONT>
	<FONT COLOR="#008000">L0_Q1</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">L0_Q2</FONT>
<FONT COLOR="#000080">};</FONT>
<B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">l1state</FONT> <FONT COLOR="#000080">{</FONT>
	<FONT COLOR="#008000">L1_NORMAL</FONT><FONT COLOR="#000080">,</FONT>
	<FONT COLOR="#008000">L1_BACK</FONT>
<FONT COLOR="#000080">};</FONT>
<B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">{</FONT>
	<FONT COLOR="#008000">L2_NORMAL</FONT><FONT COLOR="#000080">,</FONT>
	<FONT COLOR="#008000">L2_CC</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">L2_CCBACK</FONT><FONT COLOR="#000080">,</FONT>
	<FONT COLOR="#008000">L2_SC</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">L2_SCBACK</FONT><FONT COLOR="#000080">,</FONT>
	<FONT COLOR="#008000">L2_SLASH</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">L2_COMM</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">L2_COMMSTAR</FONT><FONT COLOR="#000080">,</FONT>
	<FONT COLOR="#008000">L2_SLASHSLASH</FONT>
<FONT COLOR="#000080">};</FONT>

<B><FONT COLOR="#000080">struct</FONT></B> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">{</FONT>
	<FONT COLOR="#008000">FILE</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">l0state</FONT> <FONT COLOR="#008000">l0state</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">npushback</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">pushback</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#000000"><B>4</B></FONT><FONT COLOR="#000080">];</FONT>
	<B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">pushorig</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#000000"><B>4</B></FONT><FONT COLOR="#000080">];</FONT>	<FONT COLOR="#008080">/* nonzero =&gt; trigraph pushback */</FONT>
	<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">lastgetc</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">lineno</FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">};</FONT>

<FONT COLOR="#008080">/*
 * Set up &quot;initial&quot; state.
 */</FONT>
<B><FONT COLOR="#000080">static</FONT></B> <B><FONT COLOR="#000080">void</FONT></B> <FONT COLOR="#008000">state0</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">struct</FONT></B> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">FILE</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
	<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">in</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">l0state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L0_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">npushback</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">lastgetc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">lineno</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>

<B><FONT COLOR="#000080">static</FONT></B> <B><FONT COLOR="#000080">void</FONT></B> <FONT COLOR="#008000">pushback</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">struct</FONT></B> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">,</FONT> <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">,</FONT> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">origc</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
	<FONT COLOR="#008000">assert</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">npushback</FONT> <FONT COLOR="#000080">&lt;</FONT> <B><FONT COLOR="#000080">sizeof</FONT></B> <FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">pushback</FONT><FONT COLOR="#000080">);</FONT>
	<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">pushback</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">npushback</FONT><FONT COLOR="#000080">]</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">pushorig</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">npushback</FONT><FONT COLOR="#000080">++]</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">origc</FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>

<FONT COLOR="#008080">/*
 * Get a character, doing trigraph processing.  Set *origc to 0 for normal
 * characters, or the actual input character pre-trigraph-mapping
 * for trigraph input.
 *
 * As a side effect, this can wind up getting up to 3 characters, maybe
 * stuffing two of them into the pushback buffer sp-&gt;buf[].  It also bumps
 * sp-&gt;lineno when a previously-read newline has been passed over.
 */</FONT>
<B><FONT COLOR="#000080">static</FONT></B> <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">getl0char</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">struct</FONT></B> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">,</FONT> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">origc</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
	<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">newc</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">l0state</FONT> <FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">;</FONT>

	<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">l0state</FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">origc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">while</FONT></B> <FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">getc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">))</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
		<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">lastgetc</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">)</FONT>
			<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">lineno</FONT><FONT COLOR="#000080">++;</FONT>
		<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">lastgetc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>
		<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L0_NORMAL</FONT><FONT COLOR="#000080">:</FONT>
			<FONT COLOR="#008080">/* ? =&gt; get another character; otherwise we are ok */</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'?'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
				<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L0_Q1</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">continue</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<FONT COLOR="#008000">assert</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">l0state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">L0_NORMAL</FONT><FONT COLOR="#000080">);</FONT>
			<B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L0_Q1</FONT><FONT COLOR="#000080">:</FONT>
			<FONT COLOR="#008080">/* ?? =&gt; get another character */</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'?'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
				<FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L0_Q2</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">continue</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<FONT COLOR="#008080">/* ?X =&gt; return ?, look at X later */</FONT>
			<FONT COLOR="#008000">pushback</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">);</FONT>
			<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">l0state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L0_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>'?'</B></FONT><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L0_Q2</FONT><FONT COLOR="#000080">:</FONT>
			<FONT COLOR="#008080">/*
			 * ??X, where X is trigraph =&gt; map
			 * ??X, where X is non-trigraph =&gt; tricky
			 * ??? =&gt; also tricky
			 */</FONT>
			<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'='</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">newc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'#'</B></FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'('</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">newc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'['</B></FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">newc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>')'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">newc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>']'</B></FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\''</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">newc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'^'</B></FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'&lt;'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">newc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'{'</B></FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'!'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">newc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'|'</B></FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'&gt;'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">newc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'}'</B></FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'?'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008080">/*
				 * This one is slightly tricky.  Three '?'s
				 * mean that the '?' we read two characters
				 * ago gets returned, and the two remaining
				 * '?'s leave us in Q2 state.
				 */</FONT>
				<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">l0state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L0_Q2</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>'?'</B></FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008080">/*
				 * This one returns the first ?, leaves
				 * the second ? to be re-examined, and
				 * leaves the last character to be re-examined.
				 * In any case we are back in &quot;normal&quot; state.
				 */</FONT>
				<FONT COLOR="#008000">pushback</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">);</FONT>
				<FONT COLOR="#008000">pushback</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000"><B>'?'</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">);</FONT>
				<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">l0state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L0_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>'?'</B></FONT><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<FONT COLOR="#008080">/* mapped a trigraph char -- return new char */</FONT>
			<FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">origc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">l0state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L0_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#008000">newc</FONT><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
			<FONT COLOR="#008000">panic</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000">&quot;getl0char state&quot;</FONT><FONT COLOR="#000080">);</FONT>
		<FONT COLOR="#000080">}</FONT>
	<FONT COLOR="#000080">}</FONT>
	<FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">lastgetc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>

<B><FONT COLOR="#000080">void</FONT></B> <FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">struct</FONT></B> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">*,</FONT> <B><FONT COLOR="#000080">const</FONT></B> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">*);</FONT>

<B><FONT COLOR="#000080">void</FONT></B> <FONT COLOR="#008000">process</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">FILE</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">FILE</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">out</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
	<B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">l1state</FONT> <FONT COLOR="#008000">l1state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L1_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">pendnls</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">origc</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">backc</FONT><FONT COLOR="#000080">;</FONT>
	<B><FONT COLOR="#000080">struct</FONT></B> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">;</FONT>

	<FONT COLOR="#008000">state0</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">);</FONT>
	<FONT COLOR="#008000">pendnls</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
	<FONT COLOR="#008000">backc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>		<FONT COLOR="#008080">/* defeat gcc warning */</FONT>

	<FONT COLOR="#008080">/*
	 * Slight sort-of-bug: files ending in \ cause two &quot;final&quot; getc()s.
	 */</FONT>
	<B><FONT COLOR="#000080">do</FONT></B> <FONT COLOR="#000080">{</FONT>
		<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">.</FONT><FONT COLOR="#008000">npushback</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">.</FONT><FONT COLOR="#008000">pushback</FONT><FONT COLOR="#000080">[--</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">.</FONT><FONT COLOR="#008000">npushback</FONT><FONT COLOR="#000080">];</FONT>
			<FONT COLOR="#008000">origc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">.</FONT><FONT COLOR="#008000">pushorig</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">.</FONT><FONT COLOR="#008000">npushback</FONT><FONT COLOR="#000080">];</FONT>
		<FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">trigraphs</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">getl0char</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000080">&amp;</FONT><FONT COLOR="#008000">origc</FONT><FONT COLOR="#000080">);</FONT>
		<FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
			<FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">getc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">in</FONT><FONT COLOR="#000080">);</FONT>
			<FONT COLOR="#008000">origc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">.</FONT><FONT COLOR="#008000">lastgetc</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">.</FONT><FONT COLOR="#008000">lineno</FONT><FONT COLOR="#000080">++;</FONT>
			<FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">.</FONT><FONT COLOR="#008000">lastgetc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>
		<FONT COLOR="#000080">}</FONT>

		<FONT COLOR="#008080">/*
		 * Do backslash-newline processing.
		 */</FONT>
		<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">l1state</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L1_NORMAL</FONT><FONT COLOR="#000080">:</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
				<FONT COLOR="#008000">l1state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L1_BACK</FONT><FONT COLOR="#000080">;</FONT>
				<FONT COLOR="#008000">backc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">origc</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">continue</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L1_BACK</FONT><FONT COLOR="#000080">:</FONT>
			<FONT COLOR="#008080">/*
			 * If backc is nonzero here, the backslash that
			 * got us into this state was spelled ??/ --
			 * if we eat a newline (and hence the backslash),
			 * we forget that the eaten newline was spelled
			 * this way.  This is sort of a bug, but so it goes.
			 */</FONT>
			<FONT COLOR="#008000">l1state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L1_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
				<FONT COLOR="#008000">pendnls</FONT><FONT COLOR="#000080">++;</FONT>
				<B><FONT COLOR="#000080">continue</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">pushback</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">origc</FONT><FONT COLOR="#000080">);</FONT>
			<FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#008000">origc</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">backc</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
			<FONT COLOR="#008000">panic</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000">&quot;bad l1state&quot;</FONT><FONT COLOR="#000080">);</FONT>
		<FONT COLOR="#000080">}</FONT>

		<FONT COLOR="#008080">/*
		 * Now ready to do &quot;C proper&quot; processing.
		 */</FONT>
<FONT COLOR="#0000FF"><B>#define	SYNCLINES()	while (pendnls) putc('\n', out), pendnls--</B></FONT>
<FONT COLOR="#0000FF"><B>#define	OUTPUT(ch, tri) ((tri) ? fprintf(out, &quot;??%c&quot;, tri) : putc(ch, out))</B></FONT>
<FONT COLOR="#0000FF"><B>#define	COPY()		OUTPUT(c, origc)</B></FONT>

		<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">l2state</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L2_NORMAL</FONT><FONT COLOR="#000080">:</FONT>
			<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\''</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_CC</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'&quot;'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_SC</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_SLASH</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">continue</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<FONT COLOR="#008000">SYNCLINES</FONT><FONT COLOR="#000080">();</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">COPY</FONT><FONT COLOR="#000080">();</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L2_CC</FONT><FONT COLOR="#000080">:</FONT>
			<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;EOF in character constant&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;newline in character constant&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_CCBACK</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\''</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">COPY</FONT><FONT COLOR="#000080">();</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L2_CCBACK</FONT><FONT COLOR="#000080">:</FONT>
			<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;EOF in character constant&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;newline in character constant&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_CC</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">COPY</FONT><FONT COLOR="#000080">();</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L2_SC</FONT><FONT COLOR="#000080">:</FONT>	<FONT COLOR="#008080">/* much like CC */</FONT>
			<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;EOF in string constant&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;newline in string constant&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_SCBACK</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'&quot;'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">COPY</FONT><FONT COLOR="#000080">();</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L2_SCBACK</FONT><FONT COLOR="#000080">:</FONT>
			<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;EOF in string constant&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;newline in string constant&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_SC</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">COPY</FONT><FONT COLOR="#000080">();</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L2_SLASH</FONT><FONT COLOR="#000080">:</FONT>
			<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_COMM</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c99</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_SLASHSLASH</FONT><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
				<FONT COLOR="#008000">SYNCLINES</FONT><FONT COLOR="#000080">();</FONT>
				<FONT COLOR="#008000">OUTPUT</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
					<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT>
						<FONT COLOR="#008000">COPY</FONT><FONT COLOR="#000080">();</FONT>
					<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
				<FONT COLOR="#000080">}</FONT>
			<FONT COLOR="#000080">}</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L2_COMM</FONT><FONT COLOR="#000080">:</FONT>
			<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_COMMSTAR</FONT><FONT COLOR="#000080">;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">pendnls</FONT><FONT COLOR="#000080">++;</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;EOF inside comment&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L2_COMMSTAR</FONT><FONT COLOR="#000080">:</FONT>
			<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
				<FONT COLOR="#008080">/*
				 * If comments become whitespace,
				 * and we have no pending newlines,
				 * must emit a blank here.
				 *
				 * The comment text is now all eaten.
				 */</FONT>
				<B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">whitespace</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">pendnls</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">)</FONT>
					<FONT COLOR="#008000">putc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>' '</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">out</FONT><FONT COLOR="#000080">);</FONT>
				<FONT COLOR="#008000">SYNCLINES</FONT><FONT COLOR="#000080">();</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008080">/* stay in L2_COMMSTAR state */</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;EOF inside comment&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">pendnls</FONT><FONT COLOR="#000080">++;</FONT>
				<FONT COLOR="#008080">/* FALLTHROUGH */</FONT>
			<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_COMM</FONT><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">L2_SLASHSLASH</FONT><FONT COLOR="#000080">:</FONT>
			<B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008080">/* ??? do we really care? */</FONT>
				<FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(&amp;</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;EOF inside //-comment&quot;</FONT><FONT COLOR="#000080">);</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">:</FONT>
				<FONT COLOR="#008000">l2state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">L2_NORMAL</FONT><FONT COLOR="#000080">;</FONT>
				<FONT COLOR="#008000">pendnls</FONT><FONT COLOR="#000080">++;</FONT>	<FONT COLOR="#008080">/* cheesy, but... */</FONT>
				<FONT COLOR="#008000">SYNCLINES</FONT><FONT COLOR="#000080">();</FONT>
			<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
				<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
			<FONT COLOR="#000080">}</FONT>
			<B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

		<B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
			<FONT COLOR="#008000">panic</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000">&quot;bad l2state&quot;</FONT><FONT COLOR="#000080">);</FONT>
		<FONT COLOR="#000080">}</FONT>
	<FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">while</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">);</FONT>
	<FONT COLOR="#008000">SYNCLINES</FONT><FONT COLOR="#000080">();</FONT>
<FONT COLOR="#000080">}</FONT>

<B><FONT COLOR="#000080">void</FONT></B> <FONT COLOR="#008000">warn</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">struct</FONT></B> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">,</FONT> <B><FONT COLOR="#000080">const</FONT></B> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">msg</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
	<FONT COLOR="#008000">fprintf</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">stderr</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;uncomment: %s(%d): %s\n&quot;</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">inname</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">sp</FONT><FONT COLOR="#000080">-&gt;</FONT><FONT COLOR="#008000">lineno</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">msg</FONT><FONT COLOR="#000080">);</FONT>
<FONT COLOR="#000080">}</FONT>

<B><FONT COLOR="#000080">void</FONT></B> <FONT COLOR="#008000">panic</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">const</FONT></B> <B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">msg</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
	<FONT COLOR="#008000">fprintf</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">stderr</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000">&quot;panic: %s\n&quot;</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">msg</FONT><FONT COLOR="#000080">);</FONT>
	<FONT COLOR="#008000">abort</FONT><FONT COLOR="#000080">();</FONT>
	<FONT COLOR="#008000">exit</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">EXIT_FAILURE</FONT><FONT COLOR="#000080">);</FONT>
<FONT COLOR="#000080">}</FONT>
</pre>
</code>

<br>
<br>
<br>
From Chris Mears
<br>
<br>
Here's Chris's updated version, without the bugs (says he). <B> :-) </B>
<br>
<br>
<code>
<pre>
<FONT COLOR="#008080">/*
 * C comment stripper.
 *
 * Strips comments from C or C++ code.
 */</FONT>

<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>

<B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">state_t</FONT> <FONT COLOR="#000080">{</FONT> <FONT COLOR="#008000">normal</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">string</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">character</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">block_comment</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">line_comment</FONT><FONT COLOR="#000080">};</FONT>

<B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">token_t</FONT> <FONT COLOR="#000080">{</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">backslash</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">star</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">tri1</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">tri2</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">tri_backslash</FONT><FONT COLOR="#000080">};</FONT>

<B><FONT COLOR="#000080">static</FONT></B> <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">print_mode</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">state_t</FONT> <FONT COLOR="#008000">s</FONT><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
        <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">s</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">s</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">string</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">s</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">character</FONT><FONT COLOR="#000080">);</FONT>
<FONT COLOR="#000080">}</FONT>

<B><FONT COLOR="#000080">void</FONT></B> <FONT COLOR="#008000">cstrip</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">FILE</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">infile</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">FILE</FONT> <FONT COLOR="#000080">*</FONT><FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
        <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">;</FONT>
        <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">comment_newline</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
        <B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">state_t</FONT> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">normal</FONT><FONT COLOR="#000080">;</FONT>
        <B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">token_t</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>
        <B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#008000">token_t</FONT> <FONT COLOR="#008000">last_token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>
        
        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(!</FONT><FONT COLOR="#008000">infile</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#000080">!</FONT><FONT COLOR="#008000">outfile</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">infile</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">))</FONT> <FONT COLOR="#000080">{</FONT>
                <B><FONT COLOR="#000080">return</FONT></B><FONT COLOR="#000080">;</FONT>
        <FONT COLOR="#000080">}</FONT>


        <B><FONT COLOR="#000080">while</FONT></B> <FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">ch</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">fgetc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">infile</FONT><FONT COLOR="#000080">))</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                <B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">:</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">tri2</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">tri_backslash</FONT><FONT COLOR="#000080">;</FONT>
                                <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">print_mode</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">))</FONT>
                                        <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>
                        <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">string</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">character</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">block_comment</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">star</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">normal</FONT><FONT COLOR="#000080">;</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>

                                <FONT COLOR="#008080">/* Replace block comments with whitespace. */</FONT>
                                <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">comment_newline</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                        <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>
                                <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
                                        <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>' '</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>
                                <FONT COLOR="#000080">}</FONT>
                        <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">line_comment</FONT><FONT COLOR="#000080">;</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT>
                        
                        <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

                <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">:</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">print_mode</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">))</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>

                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">backslash</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">tri_backslash</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">last_token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">token</FONT><FONT COLOR="#000080">;</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">backslash</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT>
                                
                        <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

                <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'&quot;'</B></FONT><FONT COLOR="#000080">:</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">string</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">backslash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">normal</FONT><FONT COLOR="#000080">;</FONT>
                        <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">backslash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">string</FONT><FONT COLOR="#000080">;</FONT>

                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">print_mode</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">))</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>

                        <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>
                        
                        <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

                <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\''</B></FONT><FONT COLOR="#000080">:</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">character</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">backslash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">normal</FONT><FONT COLOR="#000080">;</FONT>
                        <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">backslash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">character</FONT><FONT COLOR="#000080">;</FONT>

                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">print_mode</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">))</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>

                        <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>
                        
                        <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

                <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'\n'</B></FONT><FONT COLOR="#000080">:</FONT>
                        <FONT COLOR="#008080">/* This test is independent of the others. */</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">block_comment</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">comment_newline</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;</FONT>
                        
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>
                        
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">backslash</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">tri_backslash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">last_token</FONT><FONT COLOR="#000080">;</FONT>
                        <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">line_comment</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT>
                                        <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#008000">backslash</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">normal</FONT><FONT COLOR="#000080">;</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT>

                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">print_mode</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">))</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>

                        <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

                <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">:</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">block_comment</FONT><FONT COLOR="#000080">;</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>
                                <FONT COLOR="#008000">comment_newline</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">star</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT>
                        
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">print_mode</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">))</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>

                        <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

                <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'?'</B></FONT><FONT COLOR="#000080">:</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>
                        
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">tri1</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">tri2</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">tri2</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">tri2</FONT><FONT COLOR="#000080">;</FONT>   <FONT COLOR="#008080">/* retain state */</FONT>
                        <FONT COLOR="#000080">}</FONT> <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
                                <FONT COLOR="#008080">/* We might need the last token if this
                                 * trigraph turns out to be a backslash.
                                 */</FONT>
                                <FONT COLOR="#008000">last_token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">token</FONT><FONT COLOR="#000080">;</FONT>
                                <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">tri1</FONT><FONT COLOR="#000080">;</FONT>
                        <FONT COLOR="#000080">}</FONT>

                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">print_mode</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">))</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>

                        <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

                <B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">normal</FONT> <FONT COLOR="#000080">&amp;&amp;</FONT> <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">slash</FONT><FONT COLOR="#000080">)</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>

                        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">print_mode</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">))</FONT>
                                <FONT COLOR="#008000">fputc</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">ch</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">outfile</FONT><FONT COLOR="#000080">);</FONT>

                        <FONT COLOR="#008000">token</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">none</FONT><FONT COLOR="#000080">;</FONT>

                        <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
                <FONT COLOR="#000080">}</FONT> <FONT COLOR="#008080">/* switch */</FONT>

        <FONT COLOR="#000080">}</FONT> <FONT COLOR="#008080">/* while */</FONT>

        <B><FONT COLOR="#000080">return</FONT></B><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>


<FONT COLOR="#008080">/* Small driver program. */</FONT>

<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
        <FONT COLOR="#008000">cstrip</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">stdin</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#008000">stdout</FONT><FONT COLOR="#000080">);</FONT>

        <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>

</pre>
</code>

<br>
<br>
<br>
<br>

<p>
Here's a critique of the above, sent in by Rick Litherland. (Please note: when Rick posted this,
I hadn't yet posted Chris Mears's updated version of the code.)
</p>
<p>
(Since I find it hard to pick the solution number out of KRX12300.C 
at a glance, I'll refer to the solutions as uncomment00, uncomment01, 
and so on.)
</p>
<p>
[Rick - KR means K&amp;R. X means eXercise. 1 means Chapter 1. 23 means exercise 23.
The next digit is the category number - 0 == Cat 0 (ANSI C89, with code restricted to what
K&amp;R have discussed at this point in the book). The final digit is the solution number. 0 is
the first I received in that category, 1 is the second, and so on. (RJH)]
</p>
<p>
uncomment03 (Gregory Pietsch)
</p>
<p>
===========
</p>
<p>
I can find only one possible flaw in this, namely that it does not allow
for a slash in program text being immediately followed by a quotation
mark. One could reasonably argue that this is not a flaw at all, because
that would never happen in sensible code. On the other hand, it can
happen in legal code, as demonstrated by the following complete (if
useless) program.
</p>

<code>
<pre>
<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>
<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
    <FONT COLOR="#008080">/* print the number three */</FONT>
    <FONT COLOR="#008000">printf</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000">&quot;%d\n&quot;</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000"><B>6</B></FONT><FONT COLOR="#000080">/</FONT><FONT COLOR="#000000"><B>'\2'</B></FONT><FONT COLOR="#000080">);</FONT>
    <FONT COLOR="#008080">/* remember to return a value from main */</FONT>
    <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>
</pre>
</code>


<p>
When this is fed to uncomment03, the output is
</p>

<code>
<pre>
<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>
<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
     
    <FONT COLOR="#008000">printf</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000">&quot;%d\n&quot;</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000"><B>6</B></FONT><FONT COLOR="#000080">/</FONT><FONT COLOR="#000000"><B>'\2'</B></FONT><FONT COLOR="#000080">);</FONT>
    <FONT COLOR="#008080">/* remember to return a value from main */</FONT>
    <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>
</pre>
</code>


<p>
Clearly, uncomment03 realises that the second comment is too important to 
remove. Um, sorry, that was a feeble excuse for a joke. What's happening is 
that uncomment03 doesn't recognise the beginning of the character constant  
'\2',  so it takes the closing quote as the start of a &quot;character
constant&quot; that is never terminated. The peculiar idiom  6/'\2'  for  3  can be
replaced by the even more brain-damaged  6/&quot;\2&quot;[0]  with the same effect.
Since uncomment03 is table-driven, it's easy to make it recognise these 
situations by adding two new rules to the table.
</p>

<code>
<pre>
<FONT COLOR="#008080">/* modified krx12303.c */</FONT>
<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>

<B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[]</FONT> <FONT COLOR="#000080">=</FONT>
<FONT COLOR="#000000">&quot;0/!10\&quot;@40\'@50.@01/@11*!2&quot;</FONT>
<FONT COLOR="#000000">&quot;1\&quot;/41\'/5&quot;</FONT>            <FONT COLOR="#008080">/* added by RAL */</FONT>
<FONT COLOR="#000000">&quot;1./02*!32.!23/ 03*!33.!24\&quot;@04\\@64.@45\'@05\\@75.@56.@47.@5&quot;</FONT><FONT COLOR="#000080">;</FONT>

<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(){</FONT><B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">,</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">,</FONT><FONT COLOR="#008000">d</FONT><FONT COLOR="#000080">;</FONT><B><FONT COLOR="#000080">char</FONT></B> <FONT COLOR="#008000">s</FONT><FONT COLOR="#000080">,</FONT><FONT COLOR="#008000">n</FONT><FONT COLOR="#000080">;</FONT><FONT COLOR="#008000">s</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>'0'</B></FONT><FONT COLOR="#000080">;</FONT><B><FONT COLOR="#000080">while</FONT></B><FONT COLOR="#000080">((</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">getchar</FONT><FONT COLOR="#000080">())</FONT>
<FONT COLOR="#000080">!=</FONT><FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">){</FONT><FONT COLOR="#008000">d</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT><B><FONT COLOR="#000080">for</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">]!=</FONT><FONT COLOR="#000000"><B>'\0'</B></FONT><FONT COLOR="#000080">&amp;&amp;</FONT><FONT COLOR="#008000">d</FONT><FONT COLOR="#000080">==</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>4</B></FONT><FONT COLOR="#000080">){</FONT><B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#008000">s</FONT><FONT COLOR="#000080">&amp;&amp;</FONT>
<FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">||</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#000000"><B>'.'</B></FONT><FONT COLOR="#000080">)){</FONT><B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>2</B></FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#000000"><B>'@'</B></FONT><FONT COLOR="#000080">)</FONT><FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT><B><FONT COLOR="#000080">else</FONT></B>
<B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>2</B></FONT><FONT COLOR="#000080">]==</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">){</FONT><FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">);</FONT><FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);}</FONT><B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>2</B></FONT><FONT COLOR="#000080">]</FONT>
<FONT COLOR="#000080">==</FONT><FONT COLOR="#000000"><B>' '</B></FONT><FONT COLOR="#000080">)</FONT><FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>' '</B></FONT><FONT COLOR="#000080">);</FONT><FONT COLOR="#008000">n</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">p</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#008000">i</FONT><FONT COLOR="#000080">+</FONT><FONT COLOR="#000000"><B>3</B></FONT><FONT COLOR="#000080">];</FONT><FONT COLOR="#008000">d</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">;}}</FONT><FONT COLOR="#008000">s</FONT><FONT COLOR="#000080">=</FONT><FONT COLOR="#008000">n</FONT><FONT COLOR="#000080">;}</FONT><B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;}</FONT>
<FONT COLOR="#008080">/* end of modified krx12303.c */</FONT>
</pre>
</code>


<p>
uncomment02 (Lew Pitcher)
</p>
<p>
===========
</p>
<p>
uncomment11 (Chris Torek)
</p>
<p>
===========
</p>
<p>
These have the same problem (or non-problem, according to your point of
view) as uncomment03. If it were regarded as a problem, it could probably 
be fixed quite easily, though not (I think) as neatly as with uncomment03;
I haven't looked at these carefully enough to be sure.
</p>
<p>
uncomment01, uncomment10 (Ben Pfaff)
</p>
<p>
===========  ===========
</p>
<p>
An oversight has the effect that if a slash in program text is followed
by anything other than a star or another slash, the following character 
is dropped. For example, with input
</p>

<code>
<pre>
<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">a</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>4</B></FONT><FONT COLOR="#000080">/</FONT><FONT COLOR="#000000"><B>2</B></FONT><FONT COLOR="#000080">;</FONT>
</pre>
</code>


the output is

<code>
<pre>
<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">a</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>4</B></FONT><FONT COLOR="#000080">/;</FONT>
</pre>
</code>


<p>
The correction is the same in both cases; replace
</p>

<code>
<pre>
    <FONT COLOR="#008080">/* Program text following a slash. */</FONT>
    <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
        <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
    <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
        <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">);</FONT>
        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT>
            <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
    <FONT COLOR="#000080">}</FONT>
</pre>
</code>

<p>
by
</p>
<code>
<pre>
    <FONT COLOR="#008080">/* Program text following a slash. */</FONT>
    <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
        <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
    <B><FONT COLOR="#000080">else</FONT></B> <FONT COLOR="#000080">{</FONT>
        <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">);</FONT>
        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
            <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
        <FONT COLOR="#000080">}</FONT>
    <FONT COLOR="#000080">}</FONT>
</pre>
</code>


<p>
After this, these programs will have the same problem (or not) as the 
previous three.
</p>
<p>
uncomment12 (Chris Mears)
</p>
<p>
===========
</p>
<p>
This is a completely different kettle of fish. If you run this with
Ben Pfaff's solution as input, the output is quite bizarre; some
comments have just their initial and final slashes removed, for instance.
I've managed to find two things contributing to this. The first is 
illustrated by the input
</p>
<code>
<pre>
<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">;</FONT>
</pre>
</code>

<p>
with output
</p>

<code>
<pre>
<B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#000000"><B>''</B></FONT><FONT COLOR="#000080">;</FONT>
</pre>
</code>


<p>
This can be fixed by changing the lines
</p>

<code>
<pre>
    <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">:</FONT>
        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">string</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
</pre>
</code>


<p>
to
</p>

<code>
<pre>
    <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">:</FONT>
        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">string</FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">character</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
</pre>
</code>

<p>
However, with or without this change, the input
</p>

<p>
char *p = &quot;\\&quot;;  /* This is not a comment. */
</p>
<p>
is left unchanged. What happens is that the closing quote of the string
literal isn't recognised as such because of the preceding backlash, despite
the backslash before that. The handling of backslashes is split between three
cases (at least), and is complicated enough that I don't feel competent
to propose a remedy.
</p>

<br>
<br>
<br>
<br>
<br>
This program breaks most of the above submissions:
<br>
<br>
<code>
<pre>
<FONT COLOR="#008080">/* krx123tp.c - a test program to serve as input to krx123*.c
 *
 * This is a shameless copy of Ben Pfaff's solution, to which I have
 * added a few extra statements to further test the candidate programs
 * for this exercise. As Ben says, this program already contains lots
 * of examples of comments and not-quite-comments. I've just made it
 * a little tougher.
 *
 */</FONT>

<FONT COLOR="#008080">/* K&amp;R2 1-23: Write a program to remove all comments from a C program.
   Don't forget to handle quoted strings and character constants
   properly.  C comments do not nest.

   This solution does not deal with other special cases, such as
   trigraphs, line continuation with \, or &lt;&gt; quoting on #include,
   since these aren't mentioned up 'til then in K&amp;R2.  Perhaps this is
   cheating.

   Note that this program contains both comments and quoted strings of
   text that looks like comments, so running it on itself is a
   reasonable test.  It also contains examples of a comment that ends
   in a star and a comment preceded by a slash.  Note that the latter
   will break C99 compilers and C89 compilers with // comment
   extensions.

   Interface: The C source file is read from stdin and the
   comment-less output is written to stdout. **/</FONT>

<FONT COLOR="#0000FF"><B>#include &lt;stdio.h&gt;</B></FONT>

<B><FONT COLOR="#000080">int</FONT></B>
<FONT COLOR="#008000">main</FONT><FONT COLOR="#000080">(</FONT><B><FONT COLOR="#000080">void</FONT></B><FONT COLOR="#000080">)</FONT>
<FONT COLOR="#000080">{</FONT>
    <FONT COLOR="#008080">/* State machine's current state. */</FONT>
    <B><FONT COLOR="#000080">enum</FONT></B> <FONT COLOR="#000080">{</FONT>
        <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">STAR</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">,</FONT>
        <FONT COLOR="#008000">LITERAL</FONT>
    <FONT COLOR="#000080">}</FONT> <FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">;</FONT>

    <FONT COLOR="#008080">/* If state == QUOTE, then ' or &quot;.  Otherwise, undefined. */</FONT>
    <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">quote</FONT><FONT COLOR="#000080">;</FONT>

    <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
    <B><FONT COLOR="#000080">for</FONT></B> <FONT COLOR="#000080">(;;)</FONT> <FONT COLOR="#000080">{</FONT>
        <B><FONT COLOR="#000080">int</FONT></B> <FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">getchar</FONT><FONT COLOR="#000080">();</FONT>
        <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">EOF</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT> <FONT COLOR="#008080">//**/</FONT>
                        <FONT COLOR="#000000"><B>1</B></FONT> <FONT COLOR="#000080">/</FONT> <FONT COLOR="#000000"><B>1</B></FONT> <FONT COLOR="#000080">/</FONT><FONT COLOR="#000000"><B>'\1'</B></FONT><FONT COLOR="#000080">);</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
        <FONT COLOR="#000080">}</FONT>

        <B><FONT COLOR="#000080">if</FONT></B><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">)</FONT>
          <FONT COLOR="#008000">printf</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000">&quot;%d\n&quot;</FONT><FONT COLOR="#000080">,</FONT> <FONT COLOR="#000000"><B>6</B></FONT><FONT COLOR="#000080">/</FONT><FONT COLOR="#000000"><B>'\2'</B></FONT><FONT COLOR="#000080">);</FONT> 
        <FONT COLOR="#008080">/* line of code, and comment, added by RJH 10 July 2000 */</FONT>

        <B><FONT COLOR="#000080">switch</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">state</FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Program text following a slash. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000">&quot;/*&quot;</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#000000"><B>1</B></FONT><FONT COLOR="#000080">])</FONT> <FONT COLOR="#000080">{</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
                <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>
            <FONT COLOR="#000080">}</FONT>
            <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
            <FONT COLOR="#008080">/* Fall through. */</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Program text. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\''</B></FONT> <FONT COLOR="#000080">||</FONT> <FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'&quot;'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                <FONT COLOR="#008000">quote</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">;</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">;</FONT>
                <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#000080">}</FONT>
            <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000">&quot;/*&quot;</FONT><FONT COLOR="#000080">[</FONT><FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">])</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">SLASH</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">else</FONT></B>
                <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Comment. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">STAR</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">STAR</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Comment following a star. */</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'/'</B></FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">!=</FONT> <FONT COLOR="#000000"><B>'*'</B></FONT><FONT COLOR="#000080">)</FONT> <FONT COLOR="#000080">{</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">COMMENT</FONT><FONT COLOR="#000080">;</FONT>
                <FONT COLOR="#008000">putchar</FONT> <FONT COLOR="#000080">(</FONT><FONT COLOR="#000000"><B>' '</B></FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#000080">}</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Within quoted string or character constant. */</FONT>
            <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#000000"><B>'\\'</B></FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">LITERAL</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">else</FONT></B> <B><FONT COLOR="#000080">if</FONT></B> <FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT> <FONT COLOR="#000080">==</FONT> <FONT COLOR="#008000">quote</FONT><FONT COLOR="#000080">)</FONT>
                <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">PROGRAM</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">case</FONT></B> <FONT COLOR="#008000">LITERAL</FONT><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008080">/* Within quoted string or character constant, following \. */</FONT>
            <FONT COLOR="#008000">putchar</FONT><FONT COLOR="#000080">(</FONT><FONT COLOR="#008000">c</FONT><FONT COLOR="#000080">);</FONT>
            <FONT COLOR="#008000">state</FONT> <FONT COLOR="#000080">=</FONT> <FONT COLOR="#008000">QUOTE</FONT><FONT COLOR="#000080">;</FONT>
            <B><FONT COLOR="#000080">break</FONT></B><FONT COLOR="#000080">;</FONT>

        <B><FONT COLOR="#000080">default</FONT></B><FONT COLOR="#000080">:</FONT>
            <FONT COLOR="#008000">abort</FONT><FONT COLOR="#000080">();</FONT>
        <FONT COLOR="#000080">}</FONT>
    <FONT COLOR="#000080">}</FONT>

    <B><FONT COLOR="#000080">return</FONT></B> <FONT COLOR="#008080">/* this comment added by RJH 10 July 2000 */</FONT> <FONT COLOR="#000000"><B>0</B></FONT><FONT COLOR="#000080">;</FONT>
<FONT COLOR="#000080">}</FONT>

<FONT COLOR="#008080">/* 
   Local variables:
   compile-command: &quot;checkergcc -W -Wall -ansi -pedantic knr123.c -o knr123&quot;
   End: 
*/</FONT>


</pre>
</code>

<br>
<br>
<br>


<a href=index.html>  Back to index </a></body></html>